#include <stdio.h>
#include <stdlib.h> // Necessário para malloc e free
#include <time.h>

#define MAX 5

typedef struct {
    char nome[50];
    char cor[50];
    int tropas;
} Territorio;

int main() {
    // 1. Usando MALLOC para alocar espaço para 5 territórios
    // O malloc reserva (5 * tamanho da struct) bytes na memória
    Territorio *mapa = (Territorio *) malloc(MAX * sizeof(Territorio));

    // Verificação de segurança: se o malloc falhar, o ponteiro será NULL
    if (mapa == NULL) {
        printf("Erro: Memória insuficiente!\n");
        return 1;
    }

    int i, atacante, defensor, dado_atq, dado_def;
    int rodando = 1;
    srand(time(NULL));

    // O acesso aos dados continua igual: mapa[i].nome
    for (i = 0; i < MAX; i++) {
        printf("\n--- Cadastro do %dº Território ---\n", i + 1);
        printf("Digite o nome: ");
        scanf(" %[^\n]", mapa[i].nome);
        printf("Digite a cor: ");
        scanf(" %s", mapa[i].cor);
        printf("Digite a quantidade de tropas: ");
        scanf("%d", &mapa[i].tropas);
    }

    while (rodando) {
        printf("\n\n========= MODO DE GUERRA =========\n");
        for (i = 0; i < MAX; i++) {
            printf("[%d] %-15s | Tropas: %d\n", i, mapa[i].nome, mapa[i].tropas);
        }
        printf("==================================\n");

        printf("Escolha o territorio ATACANTE (0-4) ou -1 para sair: ");
        scanf("%d", &atacante);

        if (atacante == -1) {
            rodando = 0;
            break; 
        }

        printf("Escolha o territorio DEFENSOR (0-4): ");
        scanf("%d", &defensor);

        if (atacante < 0 || atacante >= MAX || defensor < 0 || defensor >= MAX) {
            printf("Território inválido!\n");
            continue;
        }

        if (atacante == defensor) {
            printf("Um território não pode atacar a si mesmo!\n");
            continue;
        }

        // Simulação de Batalha
        dado_atq = (rand() % 6) + 1;
        dado_def = (rand() % 6) + 1;
        int f_atq = mapa[atacante].tropas + dado_atq;
        int f_def = mapa[defensor].tropas + dado_def;

        if (f_atq > f_def) {
            printf(">>> VITORIA ATACANTE: %s <<<\n", mapa[atacante].nome);
            mapa[defensor].tropas -= 2;
            if (mapa[defensor].tropas < 0) mapa[defensor].tropas = 0;
        } else {
            printf(">>> VITORIA DEFENSOR: %s <<<\n", mapa[defensor].nome);
            mapa[atacante].tropas -= 2;
            if (mapa[atacante].tropas < 0) mapa[atacante].tropas = 0;
        }
    }

    // 2. IMPORTANTE: Sempre que usar malloc, você deve usar FREE no final
    free(mapa); 

    printf("\nMemória liberada. Jogo encerrado.\n");
    return 0;
}